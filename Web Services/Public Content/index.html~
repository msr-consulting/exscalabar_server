<!DOCTYPE html>
<head>
<title>EXSCALABAR</title>
<!-- For this case, we will assume that the server 
	  has been pointed to as nicholas.io.
-->
<script type="text/javascript">

	/* This is the location of the server.  Here it is a 
	 * named server.  Since we are not going to rely on DNS,
	 * this would need to be set up in etc/hosts.  The IP
	 * address for this particular instrument is 
	 * 10.172.240.107.
	 */
	var server = "http://exscalabar.io";
	
	/* Port that the services can be accessed on.  Generally,
	 * 8001 will be the DEBUG port and 8080 will be the official
	 * port.
	 */
	var s_port = ":8001";
	
	/* For this application, there is one web service with multiple
	 * resources.  The web service is named "Nicholas".
	 */
	var web_service = "/xService";
	
	window.setInterval("getData();", 1000);

	/* Generic function for making an ajax call.
	 * resource = the web resource used
	 * service  = the named service (such as Stop) to be called
	 * input    = any input required (this call will only handle one input)
	 * TODO: break the calls out so they are not so specific; this function 
	 * 	   should take a single url that it does not have to assemble here.
	 */
	function ajaxCall(resource, service, input)
            {
                var url;
                
                if (typeof input == 'undefined') {
                    url = server + s_port + web_service + "/" + resource + "/" + service;
                }
                else
                {
                    url = server + s_port + web_service + resource + "/" + service + "?" + service + "=" + input;
                }
                var xmlhttp;
                if (window.XMLHttpRequest)
                {// code for IE7+, Firefox, Chrome, Opera, Safari
                    xmlhttp = new XMLHttpRequest();
                }
                else
                {// code for IE6, IE5
                    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                }
                xmlhttp.open("GET", url, true);
                xmlhttp.send();
            }
            
   function ajaxURL(url) {
   				var xmlhttp;
                if (window.XMLHttpRequest)
                {// code for IE7+, Firefox, Chrome, Opera, Safari
                    xmlhttp = new XMLHttpRequest();
                }
                else
                {// code for IE6, IE5
                    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                }
                xmlhttp.open("GET", url, true);
                xmlhttp.send();
   	
   }

	function getData()
            {
               var xmlhttp;
                var response;
                var jsonobj;
                var time;
                if (window.XMLHttpRequest)
                {// code for IE7+, Firefox, Chrome, Opera, Safari
                    xmlhttp = new XMLHttpRequest();
                }
                else
                {// code for IE6, IE5
                    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                }
                xmlhttp.onreadystatechange = function()
                {
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
                    {
                        response = xmlhttp.responseText;
                        jsonobj = JSON.parse(response);
                        time = jsonobj.PAS.Time;
                        document.getElementById("time").value = time;


                    }
                }
                
                var url = server+s_port+web_service + '/General/Data';
                xmlhttp.open("GET",url, true);
                xmlhttp.send();
                
            }
            
            /* Toggle the boolean.  This should be passed to the web service
             * as either a number or text.  
             * e = the button that was clicked for the event.
             */
            function setFilter(e) {
            	if (e.value=="Filter") {
            		e.value = "Sample";
            		
            	}
            	else {
            		e.value = "Filter";
            	}
            	
            }
            
            /* Toggle the state of the PAS from speaker->laser and vice-versa.  
             * This should be passed to the web service as either a number or text.  
             * e = the button that was clicked for the event.
             */
            function changePASOutput(e) { 
            	var sendVal = 0;           	
            	if (e.value == "Laser"){
            		e.value="Speaker";
            		sendVal = 1;
            		}
            	else {
            		e.value = "Laser";
            	}   
            	ajaxCall('/PAS_CMD','SpkSw',sendVal.toString());        	
            }
            
            function updatePASLaser() {
            	var mod = document.getElementById("modulation").value;
            	var dc = document.getElementById("dc_pas").value;
            	var f = document.getElementById("f").value;
            	
            }
            
            function updatePASSpeaker() {
            	var Vrange = document.getElementById("Vr_spk").value;
            	var Voffset = document.getElementById("Vo_spk").value;
            	var fcent = document.getElementById("fcent").value;
            	var df = document.getElementById("df").value;
            	
            	var url = server+s_port+web_service + '/PAS_CMD/Spk?df=' + df.toString() + '&f0=' + fcent.toString();
            	ajaxURL(url);
            	
            	url = server+s_port+web_service + '/PAS_CMD/UpdateSpkVparams?Voffset=' + Voffset.toString() + '&Vrange=' + Vrange.toString();
            	
            	ajaxURL(url);
            }
            
            function updateRed(){
            		var DC = document.getElementById("dc_crds_red").value;
            		var f = document.getElementById("f_crds_red").value;
            		
            		var url = server + s_port + web_service + "/CRDS_CMD/ChangeRedRate?Rate=" + f.toString();
            		ajaxURL(url);
            		
            }
            
            function changeQsp() {
            	var Qsp = new Array(6);
            	var id;
            	var val = document.getElementById("a_0").value;
            	for (i=0;i<6;i++) {
            		id = "a_" + i;
            		val = document.getElementById(id.toString()).value;
            		Qsp[i] = val;
            	}
            }
</script>

<style type="text/css">
	.number_input{
		width:6em;
	}
	fieldset{
		width:400px;
		/*margin-right: 10px;*/
	}
	.top-legend{
		color:blue;	
	}
	fieldset.inner_fs{
		width: 370px;	
	}
	fieldset.inner_sm{
		float:left;
		width: 120px;	
		margin-right: 10px;
	}
	fieldset.wide{
		width:800px;	
		height: 100%
	}
	fieldset.sm_fs{
		float:left;
		width: 220px;
	}
	#crds_fs{
		width:320px;
		padding:15px;	
	}
	.col{
		float:left;	
	}
	footer{
		width:100%;	
	}
	input.number_out{
		width: 6em;	
	}
	input[type="button"]{
		width:6em;
	}
	label{
		margin:0;
		padding:0;	
	}
	.sm, .md, .lg{
		float:left;
		text-align: right;
		margin-right: 0.5em;	
	}	
	
	.sm {
		width: 	4em;
	}
	.md{
		width: 6em;
			
	}
	.lg{
		width: 7em;	
	}
</style>
</head>
<body>
	<header><h1>NICHOLAS</h1></header>
	<hr>
	<!-- General functionality is defined below -->
	<div class="col">
	<fieldset>
		<legend class="top-legend">General Functionality</legend>
		<input type="button" onclick="ajaxCall('General', 'Stop');" value="Stop" title="Shutsdown system on chassis if connected."><br>
		<label for="time">Time:</label><input type="text" name="time" id="time" readonly>
		<input type="button" id="filter" value="Filter" onclick="setFilter(this);">
	</fieldset>
	<fieldset>
		<legend class="top-legend">CRDS</legend>
		<fieldset class="inner_fs" onchange="updateBlue();">
			<legend>Blue Laser Input</legend>		
			<label for="dc_crds_blue">DC (%):</label><input type="number" class="number_input" id="dc_crds_blue" title="CRDS laser duty cycle in %." min="10" max="90" value="50">
			<label for="f_crds_blue">f (Hz):</label><input type="number" class="number_input" id="f_crds_blue" title="CRDS laser rep rate in Hz." min="10" max="5000" value="2000">
		</fieldset>
		<fieldset class="inner_fs" onchange="updateRed();">
			<legend>Red Laser Input</legend>		
			<label for="dc_crds_red">DC (%):</label><input type="number" class="number_input" id="dc_crds_red" title="CRDS laser duty cycle in %." min="10" max="90" value="50">
			<label for="f_crds_red">f (Hz):</label><input type="number" class="number_input" id="f_crds_red" title="CRDS laser rep rate in Hz." min="10" max="5000" value="2000">
		</fieldset>
	</fieldset>
	
	<fieldset>
		<legend class="top-legend">PAS</legend>
		<fieldset class="sm_fs" onchange="updatePASSpeaker();">
			<legend>Speaker</legend>
			<label for="Vr_spk" class="lg">V<sub>range</sub> (V):</label>
			<input type="number" id="Vr_spk" class="number_input" value="0.1" title="Voltage rage applied to speaker output." min="0" max="10"><br>
			<label for="Vo_spk" class="lg">V<sub>offset</sub> (V): </label>
			<input type="number" id="Vo_spk" class="number_input" value="0" title="Voltage offset applied to speaker output." min="0" > <br>
			<label for="fcent" class="lg">f<sub>center</sub> (Hz): </label>
			<input type="number" id="fcent" class="number_input" value="2000" title="Center frequency for chirp."min="0"><br>
			<label for="df" class="lg">df (Hz): </label>
			<input type="number" id="df" class="number_input" value="150" title="Chirp bandwidth." min="0" max="1000"><br>
		</fieldset>
		
		<fieldset class="sm_fs" onchange="updatePASLaser(this);">		
			<legend>Laser</legend>	
			<label for="f" class="lg">Frequency (Hz):</label>
			<input type="number" id="f" class="number_input" value="2000" min="0" max="5000" title="Modulation frequency in Hz."><br>
			<label for="modulation" class="lg">Modulation</label>
			<select id="modulation" onchange="changeMod();">
				<option value="sine">Sine</option>
				<option value="square">Square</option>			
			</select>
		</fieldset>
		<input type="button" value="Speaker" onclick="changePASOutput(this);" id="pasOutput">
	</fieldset>
	<fieldset id="tec_pas">
		<legend class="top-legend">Thermoelectric Coolers</legend>
		<fieldset class="sm_fs">
			<legend>PAS</legend>
			<label for="tec_pas_sp" class="sm">T (&#176;C): </label>
			<input type="number" id="tec_pas_sp" class="number_input" value="20" title="PAS TEC setpiont" min="0" max="50"><br>
			<label for="tec_pas_P" class="sm">P: </label>
			<input type="number" id="tec_pas_P" class="number_input" value="1" title="PAS TEC proporational gain" min="0" max="10"><br>
			<label for="tec_pas_I" class="sm">I: </label>
			<input type="number" id="tec_pas_I" class="number_input" value="0.75" title="PAS TEC integral gain" min="0" max="10"><br>
			<label for="tec_pas_D" class="sm">D: </label>
			<input type="number" id="tec_pas_D" class="number_input" value="0" title="PAS TEC derivative gain" min="0" max="10"><br>
			<input type="button" id="tec_main_pas" value="ON" title="Toggle power on the PAS TEC.">	
		</fieldset>	
		<fieldset class="sm_fs" id="tec_main">
			<legend>Main</legend>
			<label for="tec_main_sp" class="sm">T (&#176;C): </label>
			<input type="number" id="tec_main_sp" class="number_input" value="20" title="Main TEC setpiont" min="0" max="50" step="0.01"><br>
			<label for="tec_main_P" class="sm">P: </label>
			<input type="number" id="tec_main_P" class="number_input" value="1" title="Main TEC proporational gain" min="0" max="10" step="0.01"><br>
			<label for="tec_main_I" class="sm">I: </label>
			<input type="number" id="tec_main_I" class="number_input" value="0.75" title="Main TEC integral gain" min="0" max="10" step="0.01"><br>
			<label for="tec_pas_D" class="sm">D: </label>
			<input type="number" id="tec_main_D" class="number_input" value="0" title="Main TEC derivative gain" min="0" max="10" step="0.01">	<br>
			<input type="button" id="tec_main_pow" value="ON" title="Toggle main TEC power">	
		</fieldset>	
	</fieldset>
	<fieldset class="sm_fs" onchange="changeQsp();">
		<legend class="top-legend">Alicat</legend>
		<label for="a_0" class="lg">Q<sub>PAS</sub> (lpm): </label>	
		<input id="a_0" type="number" class="number_input" value="0" min="0" max="1000" step="0.1">
		<label for="a_1" class="lg">Q<sub>crds,0</sub> (lpm): </label>	
		<input id="a_1" type="number" class="number_input" value="0" min="0" max="1000" step="0.1">
		<label for="a_2" class="lg">Q<sub>crds,1</sub> (lpm): </label>	
		<input id="a_2" type="number" class="number_input" value="0" min="0" max="1000" step="0.1">
		<label for="a_3" class="lg">Q<sub>O3</sub> (lpm): </label>	
		<input id="a_3" type="number" class="number_input" value="0" min="0" max="1000" step="0.1">
		<label for="a_4" class="lg">Q<sub>purge</sub> (lpm): </label>	
		<input id="a_4" type="number" class="number_input" value="0" min="0" max="1000" step="0.1">
		<label for="a_5" class="lg">P (mb): </label>	
		<input id="a_5" type="number" class="number_input" value="850" min="0" max="1000" step="0.01">
	</fieldset>
	</div>
	<div class="col">
	<fieldset class="wide">
		<legend class="top-legend">Data</legend>
		<div class="col">	
			<fieldset id="crds_fs">
				<legend>CRDS</legend>
				<fieldset class="inner_sm">
					<legend>Cell 0</legend>
					<label for="tau_0" class="md">&tau; (&mu;s)</label><input id="tau_0" class="number_out" type="text" readonly><br>
					<label for="tauc0_0" class="md">&tau;<sub>0</sub>' (&mu;s)</label><input id="tauc_0" class="number_out" type="text" readonly><br>
					<label for="ext_0" class="md">&sigma; (Mm<sup>-1</sup>)</label><input id="ext_0" class="number_out" type="text" readonly><br>
					<label for="extc_0" class="md">&sigma;' (Mm<sup>-1</sup>)</label><input id="extc_0" class="number_out" type="text" readonly><br>
					<label for="sd_0" class="md">sd (&mu;s)</label><input id="sd_0" class="number_out" type="text" readonly><br>
					<label for="tauc_0" class="md">&tau;' (&mu;s)</label><input id="tauc_0" class="number_out" type="text" readonly><br>
					<label for="tau0_0" class="md">&tau;<sub>0</sub> (&mu;s)</label><input id="tau0_0" class="number_out" type="text" readonly><br>
					<label for="max_0" class="md">max</label><input id="max_0" class="number_out"type="text" readonly><br>
				</fieldset>		
				<fieldset class="inner_sm">
					<legend>Cell 0</legend>
					<label for="tau_1" class="md">&tau; (&mu;s)</label><input id="tau_1" class="number_out" id="tau" type="text" readonly><br>
					<label for="tauc0_1" class="md">&tau;<sub>0</sub>' (&mu;s)</label><input id="tauc_1" class="number_out" id="tau" type="text" readonly><br>
					<label for="ext_1" class="md">&sigma; (Mm<sup>-1</sup>)</label><input id="ext_1" class="number_out" id="tau" type="text" readonly><br>
					<label for="extc_1" class="md">&sigma;' (Mm<sup>-1</sup>)</label><input id="extc_1" class="number_out" id="tau" type="text" readonly><br>
					<label for="sd_1" class="md">sd (&mu;s)</label><input id="sd_1" class="number_out" id="tau" type="text" readonly><br>
					<label for="tauc_1" class="md">&tau;' (&mu;s)</label><input id="tauc_1" class="number_out" id="tau" type="text" readonly><br>
					<label for="tau0_1" class="md">&tau;<sub>0</sub> (&mu;s)</label><input id="tau0_1" class="number_out" id="tau" type="text" readonly><br>
					<label for="max_1" class="md">max</label><input id="max_1" class="number_out" id="tau" type="text" readonly><br>
				</fieldset>	
			</fieldset>
		</div>
		<div class="col">
			<fieldset class="inner_sm">
				<legend>PAS</legend>	
				<label for="f0" class="md">f<sub>0</sub> (Hz)</label><input id="f0" class="number_out" type="text" readonly><br>
				<label for="Q" class="md">Q</label><input id="Q" class="number_out" type="text" readonly><br>
				<label for="noise_lim" class="md">p</label><input id="noise_lim" class="number_out" type="text" readonly><br>
				<label for="IA" class="md">IA</label><input id="IA" class="number_out" type="text" readonly><br>
				<label for="abs" class="md">&sigma;<sub>abs</sub> (Mm<sup>-1</sup>)</label><input id="abs" class="number_out" type="text" readonly><br>
			</fieldset>
		</div>
	</fieldset>	
	</div>
	
	<!--<footer>NOAA, 2014</footer>-->
</body>